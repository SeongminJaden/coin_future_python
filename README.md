# EMA 기반 돌파 전략 자동매매 봇

Gate.io 선물 거래소에서 EMA(지수이동평균) 기반 돌파 전략을 자동으로 실행하는 Python 봇입니다.

## 📋 목차

- [전략 개요](#전략-개요)
- [주요 기능](#주요-기능)
- [설치 및 설정](#설치-및-설정)
- [매매 전략](#매매-전략)
- [함수 정의](#함수-정의)
- [사용법](#사용법)
- [주의사항](#주의사항)

## 🎯 전략 개요

### 기본 개념
- **EMA 기간**: 10, 20, 50일 지수이동평균
- **진입 조건**: 횡보장 후 EMA 위/아래에서 강한 돌파 발생
- **포지션 관리**: 자동 손절/익절 및 수수료 고려

### 매매 로직
1. **횡보장 감지**: EMA 10, 20, 50이 서로 1% 이내에 있을 때
2. **돌파 감지**: 긴 양봉/음봉으로 EMA 위/아래 돌파
3. **진입**: 레버리지 25배로 잔고의 90% 사용
4. **관리**: EMA 기반 손절/익절 및 수수료 고려

## 🚀 주요 기능

- ✅ **양방향 거래**: 롱/숏 포지션 모두 지원
- ✅ **자동 리스크 관리**: 손절/익절 자동화
- ✅ **수수료 고려**: 진입/청산/자금조달 수수료 계산
- ✅ **실시간 모니터링**: 3초마다 상태 업데이트
- ✅ **상세 로깅**: CSV 파일 및 콘솔 로그
- ✅ **API 키 보안**: .env 파일 사용

## 📦 설치 및 설정

### 1. 필요한 패키지 설치
```bash
pip install gate-api python-dotenv
```

### 2. API 키 설정
`.env` 파일을 생성하고 Gate.io API 키를 입력하세요:
```env
GATE_API_KEY=your_api_key_here
GATE_API_SECRET=your_api_secret_here
```

### 3. 설정값 조정
`test.py` 파일에서 다음 설정을 조정할 수 있습니다:
```python
LEVERAGE = 25  # 레버리지
POSITION_SIZE_PERCENT = 0.9  # 포지션 크기 (잔고의 90%)
STOP_LOSS_PERCENT = 0.005  # 손절 비율 (0.5%)
```

## 📈 매매 전략

### 진입 조건

#### 롱 진입 (상승 돌파)
1. **횡보장 확인**: EMA 10, 20, 50이 1% 이내에 있음
2. **긴 양봉 확인**: 캔들 바디가 전체 범위의 2% 이상
3. **돌파 확인**: 종가가 EMA 10, 20 위에 위치

#### 숏 진입 (하락 돌파)
1. **횡보장 확인**: EMA 10, 20, 50이 1% 이내에 있음
2. **긴 음봉 확인**: 캔들 바디가 전체 범위의 2% 이상
3. **돌파 확인**: 종가가 EMA 10, 20 아래에 위치

### 포지션 관리

#### 손절 조건
- **롱 포지션**: EMA 10 아래 0.5% 지점
- **숏 포지션**: EMA 10 위 0.5% 지점

#### 익절 조건
- **롱 포지션**: EMA 20 또는 EMA 50 도달 시 (수수료 고려)
- **숏 포지션**: EMA 20 또는 EMA 50 도달 시 (수수료 고려)

#### 수수료 고려
- **진입 수수료**: 0.075% (Taker)
- **청산 수수료**: 0.075% (Taker)
- **자금조달 수수료**: 0.01% × 3회/일

## 🔧 함수 정의

### 핵심 함수들

#### `trading_logic()`
- 메인 거래 로직 실행
- 포지션 상태 확인 및 진입/청산 결정

#### `create_order(margin_usdt, trade_side)`
- Gate.io API를 통한 주문 생성
- 마진 기반 정확한 ETH 수량 계산
- 레버리지 및 잔고 검증

#### `is_breakout_condition(candles, emas)`
- 상승 돌파 조건 확인
- 횡보장 + 긴 양봉 + EMA 위 돌파

#### `is_breakdown_condition(candles, emas)`
- 하락 돌파 조건 확인
- 횡보장 + 긴 음봉 + EMA 아래 돌파

#### `is_sideways_market(candles, emas)`
- 횡보장 판단
- EMA 10, 20, 50이 1% 이내에 있는지 확인

#### `is_long_candle(candle, threshold=0.02)`
- 긴 양봉 판단
- 캔들 바디 비율이 임계값 이상인지 확인

#### `is_short_candle(candle, threshold=0.02)`
- 긴 음봉 판단
- 캔들 바디 비율이 임계값 이상인지 확인

### 유틸리티 함수들

#### `get_current_emas()`
- 현재 EMA 10, 20, 50 계산
- Gate.io API에서 캔들 데이터 수집

#### `get_latest_candles(limit=20)`
- 최근 캔들 데이터 조회
- 1분봉 기준으로 데이터 수집

#### `log_message(msg, is_trade=False, is_status=False)`
- 로그 메시지 출력
- 거래 로그는 CSV 파일에 저장

#### `log_status()`
- 현재 상태 출력 (3초마다)
- 잔고, 포지션, 수익률 표시

#### `close_position()`
- 포지션 청산
- 시장가 주문으로 즉시 청산

## 🎮 사용법

### 1. 봇 실행
```bash
python test.py
```

### 2. 로그 확인
- **콘솔**: 실시간 상태 및 거래 로그
- **CSV 파일**: `거래로그_YYYYMMDD_HH.csv` 형식으로 저장

### 3. 모니터링
```
[로그] 상태: USDT 42.01 | 포지션: 숏 0.32 ETH | 수익률: -0.05%
[로그] 하락 돌파 조건 충족! 숏 진입 (주문금액: 37.81 USDT)
```

## ⚠️ 주의사항

### 리스크 관리
- **레버리지**: 25배로 높은 리스크
- **포지션 크기**: 잔고의 90% 사용
- **손절**: EMA 기반으로 빠른 손절

### API 제한
- Gate.io API 호출 제한 준수
- 초당 요청 수 제한 확인

### 테스트 권장
- 실제 거래 전 테스트넷에서 충분한 테스트
- 소액으로 시작하여 전략 검증

### 법적 고지
- 이 봇은 교육 목적으로 제작되었습니다
- 실제 거래 시 발생하는 손실에 대한 책임은 사용자에게 있습니다
- 각국의 암호화폐 거래 규정을 준수하세요

## 📊 성능 지표

### 백테스팅 결과 (참고용)
- **승률**: 약 60-70%
- **평균 수익률**: 거래당 0.5-2%
- **최대 손실**: 거래당 -0.5%

### 실제 거래 시 고려사항
- 시장 상황에 따른 성능 변동
- 수수료 및 슬리피지 고려
- 네트워크 지연 및 API 오류 대응

## 🤝 기여하기

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요.

## 📞 문의

- **이슈**: GitHub Issues 사용
- **개선사항**: Pull Request 환영
- **버그 리포트**: 상세한 로그와 함께 제출

---

**⚠️ 투자 경고**: 암호화폐 거래는 높은 리스크를 수반합니다. 투자 결정은 신중하게 하시기 바랍니다.
